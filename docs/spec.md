# NBA Championship Belt Tracker — Spec

## 1. Overview

Build a website that tracks the holder of an unofficial NBA “Championship Belt” for a given NBA season.

The site must:
- Prominently display the current belt holder (team name + logo).
- Display the belt holder’s next scheduled game (opponent + logos + date/time).
- Display a chronological list of all games that caused a belt transfer (date, teams w/ logos, score).
- For every team mention anywhere on the site, show the team logo alongside the team name.

This is a simple prototype:
- No user accounts
- No admin UI
- No database required
- No need to optimize for high traffic
- Prefer free services and free tiers

**Key UX requirement:** the homepage should load with the belt holder, next game, and transfer history already rendered in the initial HTML at build time (static HTML). No “fetch then fill-in” required.

Hosting: Static hosting (Cloudflare Pages or equivalent) on a custom domain.

---

## 2. Definitions & Glossary

**Season**: An NBA season identified by the starting calendar year (e.g., “2025” for 2025–26).
**Regular season**: Only regular-season games count for belt transfers.
**Belt holder**: The team currently holding the belt at the present moment.
**Transfer game**: A game that results in a belt changing teams.

---

## 3. Belt Rules (Source of Truth)

1) At the start of the season, the winner of last season’s NBA Finals holds the belt.
2) During the regular season, the belt is acquired by winning against the current belt holder.

Implementation notes:
- Transfer occurs only when the current holder **loses** a completed regular-season game.
- If the belt holder wins, the belt remains with them.
- If the belt holder does not play in a game, it cannot affect the belt.
- Ignore preseason and playoffs.

---

## 4. Supported Scope

### 4.1 Season support
- Must compute belt for the “current season” (default).
- UI currently shows only the current season; multi-season browsing is a future enhancement.

### 4.2 Games included
- Regular season only.
- Completed games only (final scores).
- Ignore postponed/cancelled games unless the data source marks them as completed.

### 4.3 Time & ordering
- Sort games by actual game start datetime (ascending).
- If two games share the same start datetime (rare), break ties deterministically (e.g., by game id).

### 4.4 Time zone
- Display dates in UTC for consistency (month/day/year).
- A small client script may localize the “computed at” timestamp for the current holder.

---

## 5. Architecture (Static-first)

### 5.1 Rendering model
- Use Astro’s static output (no SSR adapter required).
- Site homepage `/` is **pre-rendered** at build time.
- No API routes are required for the current prototype.

### 5.2 Data flow per build
When a build runs:
1) Build code loads belt data from local JSON.
2) Astro renders HTML containing:
   - current holder (logo + name)
   - next game (logos + date/time)
   - transfer history list/table
3) Static HTML is published to the host.

---

## 6. Performance & Caching

- No runtime caching is required for the static build.
- Any caching applies to static assets via the hosting provider’s default behavior.

---

## 7. Data Sources

### 7.1 Primary game data source
Use a local JSON file per season generated by a backfill script:
- `data/games-{seasonStartYear}.json`
- Must include game datetime, home/away teams, final scores, status, and season identifier

### 7.2 Team metadata
Need:
- Team abbreviation (e.g., “OKC”)
- Team full name (e.g., “Oklahoma City Thunder”)

This may come from the API or a static mapping file.

### 7.3 Logos
All team references must include a logo.
Implement a deterministic logo URL builder from team abbreviation.

---

## 8. Page Requirements

### 8.1 Homepage sections (pre-rendered)
Render these in the initial HTML:

1) **Hero: Current Belt Holder**
   - Team logo (large)
   - Team name
   - Computed-at timestamp (UTC, with optional client-side localization)

2) **Next Game**
   - Header label “Next Game”
   - Home and away team logos + names
   - Date (UTC, month/day/year)
   - Matchup indicator “vs”

3) **Transfer History**
   - Table or list of all belt transfer games in reverse chronological order (newest → oldest)
   - For each transfer:
     - Date
     - Previous holder → New holder (logos + names)
     - Final score using team abbreviations (e.g., “OKC 112 – DEN 109”)

### 8.2 Visual style
- Clean, modern, minimal
- Good spacing, consistent typography
- Responsive (works on mobile + desktop)
- Accessible: proper alt text for logos, good contrast, semantic headings

### 8.3 Logos
Every team reference must include its logo:
- Hero section
- Next game section (both teams)
- Transfer history (both teams)

### 8.4 Client-side JS
Not required for core functionality.
OK to add a small script to localize the computed-at timestamp, but the page must be complete without it.

---

## 9. Backend API

No backend API is required for the current prototype.

---

## 10. Belt Computation Algorithm (Deterministic)

Inputs:
- `games[]`: all games for the season (regular season + scheduled/final)
- `startingHolderAbbr`: the Finals champion from previous season
- `now`: current time

Steps:
1) Filter to completed regular-season games
2) Sort by `startTimeUtc` ascending (stable)
3) holder = startingHolderAbbr
4) For each game:
   - if holder not in {home, away}: continue
   - determine winner by score
   - if winner != holder:
     - record a transfer with from=holder, to=winnerAbbr, game metadata, and final score
     - holder = winner
5) Compute nextGame:
   - From all games in season (including scheduled), find the earliest game with startTimeUtc > now where holder is either home or away.
   - If none exists, nextGame = null.

Output:
- `currentHolder` = holder
- `nextGame` or null
- `transfers[]` = recorded list

---

## 11. Starting Holder (v1)

Hardcode `startingHolderAbbr` per season in `src/lib/startingHolders.ts`:
- Example: season 2025 (2025–26) → `OKC`
- Add entries as needed.

This avoids building a “find previous Finals winner” feature in v1.

Future enhancement: derive automatically from historical season results.

---

## 12. Suggested Project Structure

- `src/pages/index.astro` — SSR homepage
- `src/lib/belt.ts` — `computeBelt(...)` pure function
- `src/lib/data.ts` — `getBeltData(season, now, env)` with Cache API usage
- `src/lib/teams.ts` — team names, abbreviations, logo URL builder + overrides
- `functions/api/belt.ts` — optional Cloudflare Pages Function debugging endpoint
- `docs/spec.md` — this spec

---

## 13. Testing Requirements (Prototype-Friendly)

Minimum tests:
 - 	Unit test for computeBelt with a small synthetic schedule:
 - 	At least 2 transfers
 - 	Confirm holder after each transfer
 - 	Confirm nextGame selection logic

---

## 14. Acceptance Criteria (Definition of Done)

Performance:
- Homepage loads with all core content server-rendered (no spinner required).
- Belt data is cached via Cache API for 10 minutes.

Correctness:
- Belt logic follows the rules exactly and is deterministic.
- Transfer history includes all and only transfer games.

UX/Frontend:
- Homepage loads and displays:
  - Current holder (logo + name)
  - Next game (logos + teams + time) or “No upcoming games”
  - Transfer history list with date + teams + score
  - All team mentions display logos; broken images degrade gracefully.
- Clean modern design, responsive.

Deployment:
 - 	Site deploys on Cloudflare Pages.
 - 	Site accessible via the custom Cloudflare-managed domain.
